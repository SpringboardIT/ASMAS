@model SITSAS.Models.QuestionnairesModel
<script>
    function NewQuestionnaire() {
            @Html.Raw("$.ajax({ url: '/Home/CreateUpdateQuestionnaire?', data: 'json', type: 'GET', data: 'IsPart=true', cache: false }).success(function (result) { $('#popUpItem').empty().append(result); }).error(function (xhr, textStatus, errorThrown) { });")
                        @Html.Raw("metroDialog.open('#popUp');")
    }
    function EditQuestionnaire(id) {
        @Html.Raw("$.ajax({ url: '/Home/CreateUpdateQuestionnaire?', data: 'json', type: 'GET', data: 'ID=' + id + '&IsPart=true', cache: false }).success(function (result) { $('#popUpItem').empty().append(result); }).error(function (xhr, textStatus, errorThrown) { });")
                    @Html.Raw("metroDialog.open('#popUp');")
    }
    function AnswerQuestionnaire(id) {
       @Html.Raw("$.ajax({ url: '/Home/AnswerQuestionnaire?', data: 'json', type: 'GET', data: 'ID=' + id + '&IsPart=true', cache: false }).success(function (result) { $('#popUpItem').empty().append(result); }).error(function (xhr, textStatus, errorThrown) { });")
                   @Html.Raw("metroDialog.open('#popUp');")
    }
</script>
<h1 class="text-light">Questionnaires<span class="mif-move-down place-left" style="padding-right:5px;"></span></h1>
<hr class="thin bg-grayLighter">
@if (Model.rights.CanAdd)
{
<a class="image-button warning" onclick="NewQuestionnaire();"><span class="icon mif-plus"></span> Create</a>
}
<hr class="thin bg-grayLighter">
<hr class="thin bg-grayLighter">
<script>
                        // Close the dropdown if the user clicks outside of it
                        window.onclick = function (event) {
                            if (!event.target.matches('.sitdropbtn')) {

                                var dropdowns = document.getElementsByClassName("sitdropdown-content");
                                var i;
                                for (i = 0; i < dropdowns.length; i++) {
                                    var openDropdown = dropdowns[i];
                                    if (openDropdown.classList.contains('show')) {
                                        openDropdown.classList.remove('show');
                                    }
                                }
                            }
                        }
</script>
<table id="questionnaires" class="border bordered">
    <thead>
        <tr>
            <td style="width: 65%" class="sortable-column">Name</td>
            <td style="width: 65%" class="sortable-column">Next Date To Complete</td>
                        <td style="width: 7.5%"></td>
            <td style="width: 7.5%"></td>
        </tr>
    </thead>
    <tbody>
@if (Model.rights.CanView)
{
    foreach (var rCategories in Model.ExistingQuestionnaires)
    {
            <tr>
                <td>@rCategories.Name</td>
                @if (rCategories.FrequencyProfile != null)
                {
                    if (rCategories.FrequencyProfile.NextDateToComplete.HasValue)
                    {
                        <td>@rCategories.FrequencyProfile.NextDateToComplete.Value.ToString("d MMM yy")</td>
                    }
                    else
                    {
                        <td></td>
                    }

                }
                else
                {
                    <td></td>
                }

                <td>
@if (Model.rights.CanEdit)
{
                    <a class="image-button warning" onclick="EditQuestionnaire('@rCategories.ID')"><span class="icon mif-pencil"></span> Edit</a>
}
                </td>
                <td>
                    @if (Model.rights.CanEdit)
                    {
                        <a class="image-button warning" href="~/Home/QuestionnaireQuestions?ID=@rCategories.ID"><span class="icon mif-pencil"></span> Questions</a>
                    }
                </td>
            </tr>
    }
}


    </tbody>
</table>
<script>
                            $(document).ready(function () {
                                $('#questionnaires').DataTable({
                                    "order": [[0, "asc"]]
                                });
                            });
</script>